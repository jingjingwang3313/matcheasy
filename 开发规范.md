# 项目开发规范

##动态数据源规则
######1.  使用DataSourceKey定义的库名,MASTER结尾是主库,做写库;CLUSTER结尾为从库,做读库（读写分离）.
######2.  动态切换数据源的两个方式,理论上必须在service层切换数据源:
######      1）手动切换,用于方法内切换数据源,参考 ExamServiceImpl.testDS1 .
######      2）注解切换,注解使用参考 ExamServiceImpl.testDS2 .
######3.  涉及到一个方法内操作多个数据源的情况,建议统一使用手动切换数据源 .  
######注: 优先级( 类上注解 < 方法上注解 < 手动切换 ) , 无任何指定则使用默认数据源 , service 内调用自身方法不过切面 , service 方法执行完毕会清空数据源 .
######4.  涉及跨库多表关联查询,MySQL可利用federated引擎实现远程数据同步,可参考: https://blog.csdn.net/qq_14945327/article/details/106867442.
  
  
  
## 1. 代码规范

####基本规范
######1. 代码中的命名均不能以特殊字符（如下划线、$#符号）开始或结束，定义变量后必须有注释。
######2. 代码中的命名避免使用拼音与英文混合的方式，不允许使用中文命名。
######3. 类名统一使用UpperCamelCase风格，包名统一是小写。
######4. 方法名、参数名、成员变量、局部变量都统一使用lowerCamelCase风格。
######5. 常量命名全部大写，单词间用下划线隔开，尽量语义表达完整清楚。
######6. 各分层需要接口和实现类，实现类用Impl作后缀与接口区分。
######7. 循环体内字符串的拼接，使用StringBuilder的append方法。
######8. 尽量使用entrySet遍历Map，使用Lambda表达式遍历List。
######9. 避免出现重复的代码，必要时抽取共性方法，或者公共类，共用模块。
######10. 新增和编辑功能可以提供一个接口，通过主键的有无判断新增还是编辑。
######11. 新增和编辑时需要自动填充的字段 create_by,create_time,update_by,update_time 理论上应有值,可使用注解 @TableField(fill = FieldFill.INSERT) 或 @TableField(fill = FieldFill.INSERT_UPDATE) 标注属性实现。
######12. 新增时字段del_flag=0,理论上所有的删除使用修改 del_flag=1 进行逻辑删除,可使用注解 @TableLogic 标注属性实现。
######13. 在新增,编辑,删除时需要自动填充或逻辑删除的,应在代码生成后在实体类手动添加相对应注解来标记属性。
######14. 新增、编辑等操作数据库，需要根据页面表单需求对数据进行非空、特殊逻辑、特殊格式等校验。
######15. 各层方法命名规范： 
######1） 查询数据的方法用select/query做前缀。
######2） 新增数据的方法用add/insert做前缀。
######3） 删除数据的方法用remove/delete做前缀。
######4） 修改数据的方法用edit/update做前缀。
######5） 获取多个对象的方法用List结尾,分页用Page结尾。
######6） 获取统计值的方法用Count结尾。

####项目规范
######1. 开发统一使用开发工具IDEA，用maven构建项目导包优化，代码注释，代码格式化配置，参考： https://blog.csdn.net/shaixinxin/article/details/107011867。
######2. 开发中用到的工具类方法理论上都尽量使用commons, guava, hutool等已集成三方工具类。
######3. 包名分层统一使用controller/service/entity/dto/vo/mapper命名。
######3. 所有的service和controller理论上都应向上抛出异常，尽量少捕获异常，项目配置有全局异常处理。
######4. 所有的entity/dto/vo类理论上都必须序列化，且设置serialVersionUID = 1L，且使用lombok注解@Data等简化代码,
######   注: entity是对应表字段的实体类,理论上不允许进行字段修改。
######5. 所有的controller层rest接口注解理论上都使用@RestController注解，返回json格式数据。
######6. 所有的rest接口返回数据理论上都应包装为Result类处理返回。
######7. 所有业务类和功能类的日志记录理论上都应在类上加@Slf4j注解，所有的日志打印使用log.info(""),log.warn(""),log.error("")，禁止使用System.out.println("")。
######8. 项目框架技术整合，集成第三方插件，中间件服务等方面代码写到framework下，项目业务代码写在project中modules下。
######9. 无需身份认证和权限校验的接口地址,统一使用/**/*Nose或者/anon/**两种格式。

## 2. sql规范
######1） 数据库名，表名，字段名命名统一使用小写字母，下划线不超过4个。
######2） 在满足业务需求的条件下使用最小长度，尽可能用存储空间小的类型。
######3） 尽量使用数值型字段，若只含数值信息的字段尽量不要设计为字符型。
######4） 尽量避免使用外键，减小表之间的关联度。
######5） 尽量避免使用存储过程、触发器、函数等，容易将业务逻辑和DB耦合在一起，并且MySQL的存储过程、触发器、函数中存在一定的bug。
######6） 尽量使用合理的SQL语句减少与数据库的交互次数，避免执行大事务sql。
######7） 尽量使用主键进行update和delete。
######8） 数据库表和字段不允许私自改动，改动要提前告知，并同步库表文档。